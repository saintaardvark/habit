{% extends 'layouts/main.html' %}
{% block title %}Home{% endblock %}
{% block content %}

<div class="page-header">
  <h1>Habits</h1>
  <div id="habit_list">
    <link rel="stylesheet" href="/static/css/cal-heatmap.css" />
    <script type="text/javascript" src="/static/js/d3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="/static/js/cal-heatmap.min.js"></script>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Last done</th>
          <th>Log</th>
	  <th>Heatmap</th>
        </tr>
      </thead>

      <tbody>

        {% for habit in habits %}
	<tr>
	  <td>
	    <a href="/calendar/{{ habit.id }}">
	      {{ habit.habitname }}
	    </a>
	  </td>
	  <td>
	    {{ habit.log_time }}
	  </td>
	  <td>
	    <div "log_{{ habit.habitname }}">
	      <form action="{{ url_for('log_habit') }}" method="post">
		<input type="submit" name="log"
		       value="Log {{ habit.habitname }}" />
	      </form>
	    </div>
	  </td>
	  <td>
	    <div id="cal-heatmap-{{ habit.id }}"></div>
	    <script type="text/javascript">
	      var cal = new CalHeatMap();
	      cal.init({
		// FIXME: Don't use hardcoded date
		start: new Date(2022, 0),
		range: 1,
		domain: "year",
		subDomain: "day",
		data: "/log/{{ habit.id }}",
		itemSelector: "#cal-heatmap-{{ habit.id }}"
	      });
	    </script>
	  </td>
	</tr>
	{% endfor %}
    </table>
  </div>

  <div id="new_habit">
    <form action = "{{request.path}}" method="post">
      <label for="habit">Habit</label><br>
      <input type="text" name="habit" placeholder="Habit" />
      <input type="submit" value="Submit">
    </form>

    {% endblock     %}
